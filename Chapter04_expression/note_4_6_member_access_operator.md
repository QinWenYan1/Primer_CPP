# 📘 4.6 成员访问运算符 (Member Access Operators)

> 基于《C++ Primer》第五版。本节介绍点运算符 (`.`) 与箭头运算符 (`->`) 的用法、优先级规则及常见错误。

---

## 🧠 本节核心概念

* 点运算符 (`.`) 与箭头运算符 (`->`) 的区别
* 解引用与成员访问的优先级问题
* 表达式结果：lvalue 或 rvalue
* 常见错误：忘记加括号 / 错误地访问指针成员

---

## 点运算符 (Dot Operator)

**定义 / 理论**

* `.` 用于直接访问 **对象** 的成员。
* 语法：`object.member`。
* 运算结果：

  * 如果成员是 **lvalue** → 结果是 lvalue。
  * 否则是 rvalue。

**示例代码**

```cpp
struct Foo {
    int x;
};

Foo f;
f.x = 42;     // ✅ f.x 是 lvalue，因为 x 是一个左值成员
```

---

## 箭头运算符 (Arrow Operator)

**定义 / 理论**

* `->` 用于通过 **指针** 访问对象成员。
* `p->mem` 等价于 `(*p).mem`。
* 常用于迭代器、智能指针。
* 接受一个指针，返回一个左值

**示例代码**

```cpp
string s1 = "a string";
string *p = &s1;

auto n1 = (*p).size();  // 解引用后调用 size()
auto n2 = p->size();    // 等价写法，更简洁
```

---

## 优先级问题 (Precedence Issue) 重要！！

**定义 / 理论**

* 解引用 `*`, 和前置 `++` 的优先级 < 点运算符 `.` 和 `->` 
* 因此必须写 `(*p).mem`，否则会被解释为 `*(p.mem)`，导致错误
* 后置 `++` 优先级 > `.` 和 `->`


**错误示例**

```cpp
*p.size();   // ❌ 错误：p 是指针，没有成员 size
```

**正确写法**

```cpp
(*p).size(); // ✅ 正确
p->size();   // ✅ 推荐
```

**注意**

- ⚠️ **成员访问运算符 (`.`,`->`,`[]`) 跟后置 ++/-- 属于最高优先级组；除了它们以外的所有一元运算符（前置++/--、解引用、取地址& 等）都比它们低。**

---

## 结果类型 (Result Type)

* 点运算符和箭头运算符的结果是 **lvalue 或 rvalue**，取决于被访问的成员：

  * 如果成员是对象 → 结果是 lvalue。
  * 如果成员是方法返回值（如 `size()`）→ 结果是 rvalue。

---

## ⚠️ 注意点

* `->` 必须用于 **指针**；如果用在非指针对象会报错。
* 忘记括号时，`*p.size()` ≠ `(*p).size()`。前者会尝试访问指针的成员，编译错误。
* 推荐在访问成员时尽量使用 `->`，避免括号歧义。

---

## 🔑 小结

* `.`：对象成员访问；`->`：指针成员访问，等价于 `(*p).mem`。
* `*` 的优先级低于 `.`，要写 `(*p).mem`。
* 运算结果是否是 lvalue，取决于成员本身。
* 常见 bug：写成 `*p.size()`。

---

## 📌 考试速记版

* `.` = object.member
* `->` = (\*ptr).member
* 优先级：`*` < `.` → 必须加括号
* 结果 lvalue/rvalue 取决于成员

