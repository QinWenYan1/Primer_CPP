# 📘 4.2 Arithmetic Operators（算术运算符）

> 基于《C++ Primer》第五版。本节讨论 C++ 中算术运算符的定义与语义，包括一元与二元算术、优先级与结合性、整数提升与通常算术转换、整数除法与取余规则，以及有符号/无符号溢出与除零等边界行为。

---

## 🧠 本节核心概念（提纲）

* 一元算术运算符（unary `+` / `-`）
* 算术异常 (Arithmetic Exceptions)
* 二元运算：整数除法与取余（Integer Division & Modulus）

---

## ✅ 一元算术运算符（Unary `+` / `-`）

**定义 / 理论**

* **`+x`**：返回操作数本身（包括指针），常用于触发**整数提升**（integral promotion）
* **`-x`**：返回操作数的相反数；对小整型也会先提升再计算。
* 结果都是**右值 (rvalue)**。

**教材示例代码 / 过程**

```cpp
int    i = 1024;
int    a = +i;      // a = 1024（原样返回）
int    b = -i;      // b = -1024

unsigned char c = 255;
auto v = +c;        // 触发整数提升：c(uchar) → int，v 的类型为 int，值 255

bool   flag = true;
auto  z = -flag;    // flag 提升为 int: 1 → 取负 -1；若再转回 bool，非零即 true（不建议此写法）
```

⚠️ **注意**

* 一元 `+` 经常被忽视，但在模板/泛型场景可用于**强制类型提升**。
* **`bool` 不应该参加计算**，使用一元负号可读性差，不推荐在实际代码中使用。

---

## ✅ 算术异常 (Arithmetic Exceptions)

**定义 / 理论**

* 一些算术表达式在数学或机器层面无意义或超限 → **未定义行为**。
* **分类**：

  * **除零 (division by zero)**：永远未定义。
  * **有符号溢出(overflow)**：结果未定义。
  * **实现依赖行为**：在某些机器上“wrap around”，在其他机器可能崩溃。


```cpp
short short_value = 32767;   // short 最大值 (16 位)
short_value += 1;            // 溢出，未定义
cout << short_value << endl; // 可能输出 -32768 (wrap around)

int x = 1;
int y = 0;
// cout << x / y;            // ❌ 除零 → 未定义
```

⚠️ **注意**

* C++ 不会在编译或运行时强制报错，程序员必须自我防护。
* 不同平台/编译器对 UB 的处理可能不同（表现为回绕、错误结果、崩溃）。
* 除零与溢出是 C++ 考试和面试常问的陷阱点。
---

## ✅ 二元运算：整数除法与取余（Integer Division & Modulus）

### 📝 整数除法

* **整数 `/` 整数**：结果为整数， 如果结果为小数则**向 0 截断** （C++11）
* 异号商为负，同号商为正
  
  - 也就是说：
  1. `(-m)/n = m/(-n)=-(m/n)`
```cpp
int a = 21 / 6;    // 3（小数部分被截断）
int c = -21 / 6;   // -3（向 0 截断）
``` 

### 📝 取余

* **`%` 余数**：`m%n` **与被除数 `m`（左操作数）同号** (C++11)

  - 也就是说：
  1. `m%(-n) = m%n` 
  2. `(-m)%n = -(m%n)`
* 恒等式：`(m / n) * n + (m % n) == m`（`n != 0` 时成立）



```cpp
int b = 21 % 6;    // 3
int d = -21 % 6;   // -3（余数与被除数 -21 同号）
int e = 21 % -5;   // 1（余数与被除数 21 同号 → 正）
```

⚠️ **注意点**

* `%` 只作用于整数；浮点请用 `std::fmod` 等库函数。
* C++11 规定：整数除法结果必须**向 0 截断**；商的符号由操作数的符号决定（同号正，异号负）

---


## 🔑 小结

* 算术运算分一元/二元；结果通常为右值。
* 整数除法**向 0 截断**；`%` 的符号跟随**被除数**。
* **有符号溢出未定义**、**无符号溢出回绕**；**除零未定义**。
* 以下表格表示操作符号优先级：
  一元 > 乘/除/余 > 加/减；均左结合；括号优先确保可读性。


  | Operator | Function       | Use          |
  |----------|---------------|--------------|
  | +        | unary plus    | `+ expr`     |
  | -        | unary minus   | `- 
  |
  expr`     |
  | *        | multiplication| `expr * expr`|
  | /        | division      | `expr / expr`|
  | %        | remainder     | `expr 
  |
  % expr`|
  | +        | addition      | `expr + expr`|
  | -        | subtraction   | `expr - expr`|


---

## 📌 考试速记版

* **优先级**：Unary > `* / %` > `+ -`（左结合）
* **提升/转换**：小整型 → `int`；混合算术走“共同类型”
* **/ 与 %**：`/` 向 0 截断；`%` 跟被除数符号；`(m/n)*n+m%n==m`
* **UB 红线**：有符号溢出、除零 = 未定义；无符号溢出 = 模 2ⁿ 回绕

