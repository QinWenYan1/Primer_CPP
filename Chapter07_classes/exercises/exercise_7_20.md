# ğŸ“ Exercise 7.20: å‹å…ƒå‡½æ•°çš„ç”¨é€”ä¸æƒè¡¡

**åŸé¢˜ï¼š** When are friends useful? Discuss the pros and cons of using friends.

## âœ… ä½ çš„ç­”æ¡ˆåˆ†æ

**ä½ çš„å›ç­”ï¼š**
> "å’Œç›¸å…³ç±»åŒå±äºä¸€ä¸ªæ¥å£ï¼Œ å¹¶ä¸”æˆ‘ä»¬éœ€è¦è¿™ä¸ªå‹å…ƒå‡½æ•°å»å®Œæˆæ›´ä¸ºå¤æ‚çš„æ“ä½œ
> 
> pros: ç›¸æ¯”äºå…¶ä»–éæˆå‘˜ç±»å‡½æ•°ï¼Œ å‹å…ƒå‡½æ•°å¯ä»¥åšå‡ºæ›´çµæ´»çš„å¯¹ç±»çš„ä¿®æ”¹æ“ä½œ
> 
> cons: æœ‰æš´éœ²ç±»å†…éƒ¨æ•°æ®çš„é£é™©ï¼Œ å¯¼è‡´bugæŸ¥æ‰¾èŒƒå›´æ‰©å¤§ï¼ŒåŒæ—¶ä¿®æ”¹ç”¨æˆ·ä»£ç çš„æ—¶å€™ï¼Œ éœ€è¦è€ƒè™‘åˆ°è¿™äº›å‹å…ƒå‡½æ•°ï¼Œå¢å¤§å·¥ä½œé‡"

## ğŸ¯ å®Œæ•´ç­”æ¡ˆ

### ğŸ” å‹å…ƒå‡½æ•°çš„æœ‰ç”¨åœºæ™¯

**1. è¿ç®—ç¬¦é‡è½½**
```cpp
class Complex {
private:
    double real, imag;
public:
    // é‡è½½è¾“å‡ºè¿ç®—ç¬¦éœ€è¦è®¿é—®ç§æœ‰æˆå‘˜
    friend std::ostream& operator<<(std::ostream& os, const Complex& c);
};

std::ostream& operator<<(std::ostream& os, const Complex& c) {
    os << c.real << " + " << c.imag << "i";  // è®¿é—®ç§æœ‰æˆå‘˜
    return os;
}
```

**2. éœ€è¦è®¿é—®å¤šä¸ªç±»ç§æœ‰æˆå‘˜çš„å‡½æ•°**
```cpp
class A; class B;

class A {
private:
    int secret_a;
    friend void access_both(const A& a, const B& b);
};

class B {
private:
    int secret_b;
    friend void access_both(const A& a, const B& b);
};

void access_both(const A& a, const B& b) {
    // å¯ä»¥åŒæ—¶è®¿é—®Aå’ŒBçš„ç§æœ‰æˆå‘˜
    std::cout << a.secret_a + b.secret_b;
}
```

**3. ç´§å¯†ç›¸å…³çš„å·¥å…·å‡½æ•°**
```cpp
class Matrix {
private:
    vector<vector<double>> data;
public:
    friend Matrix transpose(const Matrix& m);  // è½¬ç½®æ“ä½œéœ€è¦è®¿é—®å†…éƒ¨æ•°æ®
};

Matrix transpose(const Matrix& m) {
    Matrix result;
    // ç›´æ¥è®¿é—®m.dataè¿›è¡Œè½¬ç½®æ“ä½œ
    return result;
}
```

### ğŸ“Š å‹å…ƒçš„ä¼˜ç¼ºç‚¹åˆ†æ

#### âœ… ä¼˜ç‚¹ (Pros)

**1. å¢å¼ºçµæ´»æ€§**
- å…è®¸éæˆå‘˜å‡½æ•°è®¿é—®ç§æœ‰æ•°æ®ï¼Œå®ç°æ›´å¤æ‚çš„æ“ä½œ
- ä¿æŒå‡½æ•°ä¸ç±»çš„é€»è¾‘åˆ†ç¦»ï¼ŒåŒæ—¶è·å¾—æˆå‘˜å‡½æ•°çš„è®¿é—®æƒé™

**2. ä¿æŒæ¥å£ç®€æ´**
```cpp
// æ²¡æœ‰å‹å…ƒ - éœ€è¦ç¹ççš„æ¥å£
class WithoutFriend {
private:
    int data[100];
public:
    int get_element(int i) const { return data[i]; }  // ç¹ççš„æ¥å£
};

// ä½¿ç”¨å‹å…ƒ - ç›´æ¥æ“ä½œ
class WithFriend {
private:
    int data[100];
    friend void process_data(const WithFriend& obj);  // ç›´æ¥è®¿é—®
};
```

**3. æ”¯æŒå¯¹ç§°æ“ä½œ**
```cpp
class Vector {
private:
    double x, y;
public:
    friend Vector operator*(double scalar, const Vector& v);  // æ ‡é‡*å‘é‡
};

Vector operator*(double scalar, const Vector& v) {
    return Vector(scalar * v.x, scalar * v.y);  // å¯¹ç§°æ“ä½œ
}
```

#### âŒ ç¼ºç‚¹ (Cons)

**1. ç ´åå°è£…æ€§**
- å‹å…ƒå‡½æ•°å¯ä»¥ç»•è¿‡æ‰€æœ‰è®¿é—®æ§åˆ¶ï¼Œç ´åäº†ä¿¡æ¯éšè—åŸåˆ™
- å¢åŠ äº†ç±»å®ç°çš„ä¾èµ–å…³ç³»

**2. å¢åŠ ç»´æŠ¤æˆæœ¬**
```cpp
class Original {
private:
    int data;
    friend void friend_function(Original& obj);
};

// å¦‚æœä¿®æ”¹ç±»å®ç°...
class Modified {
private:
    string data;  // æ”¹å˜æ•°æ®ç±»å‹
    friend void friend_function(Original& obj);  // âŒ æ‰€æœ‰å‹å…ƒå‡½æ•°éƒ½éœ€è¦ä¿®æ”¹
};
```

**3. æµ‹è¯•å¤æ‚æ€§å¢åŠ **
- å‹å…ƒå‡½æ•°éœ€è¦ä¸ç±»ä¸€èµ·æµ‹è¯•
- éš¾ä»¥æ¨¡æ‹Ÿå’Œéš”ç¦»æµ‹è¯•

**4. è®¾è®¡å‘³é“**
- è¿‡åº¦ä½¿ç”¨å‹å…ƒå¯èƒ½è¡¨æ˜ç±»è®¾è®¡æœ‰é—®é¢˜
- å¯èƒ½åº”è¯¥é‡æ„ä¸ºæˆå‘˜å‡½æ•°æˆ–é‡æ–°è®¾è®¡æ¥å£

### ğŸ¯ ä½¿ç”¨å‹å…ƒçš„æœ€ä½³å®è·µ

**é€‚åº¦ä½¿ç”¨åŸåˆ™ï¼š**
```cpp
// âœ… å¥½çš„ä½¿ç”¨ - å¿…è¦çš„è¿ç®—ç¬¦é‡è½½
friend std::ostream& operator<<(std::ostream&, const MyClass&);

// âœ… å¥½çš„ä½¿ç”¨ - ç´§å¯†ç›¸å…³çš„å·¥å…·å‡½æ•°
friend MyClass create_from_file(const std::string& filename);

// âŒ é¿å…çš„ä½¿ç”¨ - æ™®é€šå·¥å…·å‡½æ•°
friend void some_random_function(MyClass&);  // åº”è¯¥é€šè¿‡å…¬å…±æ¥å£å®ç°
```

### ğŸ“ ä½ çš„ç­”æ¡ˆè¯„ä»·

**å¾—åˆ†ï¼š8/10**

**æ­£ç¡®çš„åœ°æ–¹ï¼š**
- âœ… ç†è§£äº†å‹å…ƒæä¾›æ›´çµæ´»çš„æ“ä½œèƒ½åŠ›
- âœ… è®¤è¯†åˆ°å‹å…ƒä¼šæš´éœ²å†…éƒ¨æ•°æ®çš„é£é™©
- âœ… æŒ‡å‡ºç»´æŠ¤æˆæœ¬å¢åŠ çš„é—®é¢˜

**å¯ä»¥è¡¥å……çš„åœ°æ–¹ï¼š**
- ğŸ” **å…·ä½“åº”ç”¨åœºæ™¯**ï¼šè¿ç®—ç¬¦é‡è½½ã€è·¨ç±»æ“ä½œç­‰
- ğŸ” **å°è£…æ€§ç ´å**ï¼šå‹å…ƒç›´æ¥è¿èƒŒäº†é¢å‘å¯¹è±¡çš„å°è£…åŸåˆ™
- ğŸ” **è®¾è®¡åŸåˆ™**ï¼šå‹å…ƒåº”è¯¥æ˜¯æœ€åçš„é€‰æ‹©ï¼Œä¸æ˜¯é¦–é€‰çš„è§£å†³æ–¹æ¡ˆ

**æ”¹è¿›åçš„æ€»ç»“ï¼š**
> "å‹å…ƒå‡½æ•°åœ¨ä¸ç±»ç´§å¯†ç›¸å…³ä½†åˆä¸é€‚åˆä½œä¸ºæˆå‘˜å‡½æ•°çš„åœºæ™¯ä¸‹å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚è¿ç®—ç¬¦é‡è½½ã€éœ€è¦è®¿é—®å¤šä¸ªç±»ç§æœ‰æˆå‘˜çš„å‡½æ•°ç­‰ã€‚ä¼˜ç‚¹æ˜¯æä¾›äº†æ“ä½œçµæ´»æ€§å¹¶ä¿æŒæ¥å£ç®€æ´ï¼Œç¼ºç‚¹æ˜¯ç ´åäº†å°è£…æ€§ã€å¢åŠ ç»´æŠ¤æˆæœ¬ï¼Œå¹¶å¯èƒ½æš—ç¤ºè®¾è®¡é—®é¢˜ã€‚åº”è¯¥è°¨æ…ä½¿ç”¨ï¼Œåªåœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚"