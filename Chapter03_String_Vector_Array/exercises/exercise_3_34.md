### Exercise 3.34 解答

**题目：**
已知 `p1` 和 `p2` 指向同一数组中的元素，解释下面的代码作用，并说明是否有可能不合法：

```cpp
p1 += p2 - p1;
```

---

**解答：**

1. **代码作用：**

   * 表达式 `p2 - p1` 计算 `p2` 与 `p1` 之间的偏移量（元素个数）。
   * 将该偏移量加到 `p1` 上，相当于把 `p1` 移动到与 `p2` 相同的位置。
   * 因此，执行这行代码后，`p1` 与 `p2` 指向同一个元素，效果等同于 `p1 = p2;`。

2. **合法性：**

   * 在题目前提下（`p1` 和 `p2` 都指向同一数组的元素），这段代码是合法的。
   * 指针相减在同一数组范围内是定义良好的行为，结果保证正确。

3. **可能不合法的情况（脱离前提）：**

   * 如果 `p1` 和 `p2` 不在同一数组中 → `p2 - p1` 未定义。
   * 如果 `p1` 或 `p2` 是空指针或类型不匹配 → 未定义。
   * 极端情况下，若数组极大导致差值超出 `ptrdiff_t` 范围，也可能出错（实际很少发生）。

---

**结论：**
在本题给定条件下，这段代码始终合法，作用就是把 `p1` 移到 `p2` 所在的位置。


