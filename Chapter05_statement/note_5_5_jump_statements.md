# 📘 5.5 Jump Statements (跳转语句)

> 来源说明：C++ Primer 5.5 | 本节涵盖：break, continue, goto 三种跳转语句的定义、用法、注意事项以及它们对程序流程的控制。

## 🧠 本节核心概念（提纲目录）
*   break 语句：终止最近的循环或 switch 语句
*   continue 语句：终止当前迭代，立即开始下一次迭代
*   goto 语句：无条件跳转（不推荐使用）
*   作用域与跳转语句的相互作用

---

## ✅ break 语句
**定义 / 理论**
*   `break` 语句用于**终止**离它**最近的** `while`, `do while`, `for`, 或 `switch` 语句。
*   执行流将从被终止语句之后的**第一条语句**开始恢复。
*   `break` 只能出现在迭代语句或 `switch` 语句内部（包括嵌套在这些结构内部的语句或块）。
*   `break` 只影响离它**最近**的封闭循环或 `switch`。

**教材示例代码 / 过程**
```cpp
string buf;
while (cin >> buf && !buf.empty()) { // 外层 while 循环
    switch(buf[0]) { // switch 语句
    case '-':
        // 处理到第一个空白符
        for (auto it = buf.begin()+1; it != buf.end(); ++it) // 内层 for 循环
        {
            if (*it == ' ')
                break; // #1, 终止内层的 for 循环
            // ...
        }
        // break #1 将控制权转移到这里
        // 剩余的 '-' 处理代码:
        break; // #2, 终止 switch 语句
    case '+':
        // ...
    } // switch 结束
    // break #2 将控制权转移到这里
} // while 结束
```
*   `break #1` 终止了紧跟 `case '-'` 标签的 `for` 循环，但**没有**终止外层的 `switch` 语句，甚至没有终止当前 `case` 的处理。处理会继续执行 `for` 循环之后的语句。
*   `break #2` 终止了 `switch` 语句，但**没有**终止外层的 `while` 循环。处理会继续执行 `while` 循环的条件判断。

**注意点**
*   ⚠️ `break` 只能跳出**一层**嵌套结构。
*   💡 在复杂的嵌套循环和 `switch` 中，清晰地注释 `break` 的目标有助于理解代码流程。

---
## ✅ continue 语句
**定义 / 理论**
*   `continue` 语句**终止**离它最近的循环的**当前迭代**，并立即开始**下一次迭代**。
*   `continue` 只能出现在 `for`, `while`, 或 `do while` 循环内部（包括嵌套在这些结构内部的语句或块）。
*   和 `break` 一样，`continue` 也只影响离它**最近**的封闭循环。
*   `continue` 可以出现在 `switch` 语句中，但**仅当**该 `switch` 嵌套在某个迭代语句内部时。

**循环中 continue 的行为**
*   在 `while` 或 `do while` 中：执行流继续到**条件判断**表达式。
*   在传统 `for` 循环中：执行流继续到 `for` 头中的**表达式**（通常是步进表达式）。
*   在`Range for` 循环中：执行流继续通过**初始化控制变量**为序列中的下一个元素。

**教材示例代码 / 过程**
```cpp
string buf;
while (cin >> buf && !buf.empty()) {
    if (buf[0] != '_')
        continue; // 条件不满足，跳过本次循环剩余部分，直接进入下一次迭代（读取新输入）
    // 能执行到这里的输入，其开头一定是下划线；开始处理 buf ...
}
```
*   此循环只处理以下划线 `_` 开头的单词。对于其他单词，`continue` 会跳过当前迭代的剩余代码，直接回到循环条件处读取下一个输入。

**注意点**
*   ⚠️ `continue` 在 `switch` 中的使用受到严格限制，必须确保 `switch` 本身位于循环内。
*   💡 `continue` 是跳过无效或不需要的迭代项的有效工具。

---

## ✅ goto 语句
**定义 / 理论**
*   `goto` 语句提供了一种在**同一函数内**进行**无条件跳转**的能力。
*   语法：`goto label;`，其中 `label` 是一个用于标识语句的标识符。
*   标签语句的形式：`label: statement`（例如 `end: return;`）。
*   标签标识符独立于变量和其他标识符的名称，因此可以重名而不会相互干扰。

**最佳实践**
*   **🚫 程序不应使用 `goto`。** `goto` 会使程序难以理解和修改。

**教材示例代码 / 过程**
```cpp
// 向后跳转（跳回代码前面）是允许的
begin: // 标签
    int sz = get_size();
    if (sz <= 0) {
        goto begin; // 跳回 begin 标签
    }
```
*   执行 `goto` 跳回 `begin` 时，变量 `sz` 会被**销毁**。
*   当控制流在跳转后再次经过 `int sz = get_size();` 时，`sz` 会被**重新定义和初始化**。
*   跳回到**已经被定义变量之前**是可以的

**作用域限制**
*   `goto` **不能**跳过某个**初始化了的变量**的定义（即不能从该变量作用域之外跳转到其作用域之内）。
```cpp
// ...
    goto end; // 错误：goto 跳过了一个已初始化变量的定义
    int ix = 10; // ix 在此处被定义和初始化
end:
    // 错误：此处的代码可能会使用 ix，但 goto 跳过了它的声明
    ix = 42;
```

**注意点**
*   ⚠️ **绝对避免使用 `goto`**。现代编程风格几乎总能通过循环、条件语句和函数调用来更好地组织代码。
*   ⚠️ 跳转时必须严格遵守作用域规则，不能绕过变量的初始化。

---
## 🔑 本节总结
*   **`break`**：用于**立即退出**最近的循环或 `switch` 语句。它是跳出深层嵌套循环的常用手段。
*   **`continue`**：用于**立即跳过**当前循环迭代的剩余部分，并开始下一次迭代。它常用于过滤不符合条件的迭代项。
*   **`goto`**：提供**无条件跳转**，但**强烈不推荐使用**，因为它会严重破坏代码的结构性和可读性。应始终优先使用结构化的控制流语句（如循环和条件判断）来替代它。
*   **作用域是关键**：无论是 `break`, `continue` 还是 `goto`，都需要注意变量**作用域**和**生命周期**的变化。特别是 `goto`，不能跳过带有初始化的变量定义。

---
## 📌 考试速记版
*   **`break`**: 终止最近 `loop`/`switch`。
*   **`continue`**: 跳过本次，继续下次迭代。
*   **`goto label`**: 无条件跳转 (🚫禁用)。
*   **规则**: `goto` 不能跳过带初始化的变量定义。