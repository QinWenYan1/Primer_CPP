# 📘 5.2 语句作用域 (Statement Scope)

> 来源说明：C++ Primer 第5章第2节 | 本节涵盖：在控制结构（if、switch、while、for）中定义变量的作用域规则和限制

---

## 🧠 本节核心概念（提纲目录）
*   控制结构中变量的作用域
*   变量可见性规则
*   变量初始化要求
*   访问控制变量的方法

---

## ✅ 控制结构中变量的作用域
**定义 / 理论**
*   可以在 `if`, `switch`, `while`, `for` 语句的控制结构中定义变量。
*   在此类语句中定义的变量只在该语句内部可见。
*   语句结束后，这些变量就会超出作用域，无法再访问。

**教材示例代码 / 过程**
```cpp
while (int i = get_num()) // 每次迭代都会创建并初始化 i
    cout << i << endl;    // i 在此处可见
i = 0; // 错误：i 在循环外部不可访问
```

**注意点**
*   ⚠️ 控制结构中定义的变量在语句结束后立即被销毁。
*   💡 这种设计有助于限制变量的作用范围，避免命名冲突。

---

## ✅ 访问控制变量的方法
**定义 / 理论**
*   如果需要在语句外部访问控制变量，必须在语句外部定义该变量。
*   外部定义的变量可以在控制结构中使用，并且语句结束后仍然可用。

**教材示例代码 / 过程**
```cpp
// 查找第一个负元素
auto beg = v.begin(); // 在外部定义变量
while (beg != v.end() && *beg >= 0)
    ++beg;            // 在循环内部使用外部变量
if (beg == v.end())
    // 此时仍然可以访问 beg，我们知道 v 中所有元素都大于等于零
```

**注意点**
*   💡 将变量定义在外部可以延长其生命周期，使其在语句结束后仍然可用。
*   ⚠️ 需要注意外部变量的初始化状态，避免使用未初始化的变量。

---

## ✅ 知识点 3: 变量初始化要求
**定义 / 理论**
*   在控制结构中定义的变量会被该结构使用，因此必须进行初始化。
*   每次进入控制结构时（如每次循环迭代），变量都会重新创建和初始化。

**教材示例代码 / 过程**
```cpp
// 正确：变量在控制结构中初始化
while (int i = get_num()) { // i 在每次迭代时都重新初始化
    // 使用 i...
}

// 错误：未初始化的变量（假设示例）
// while (int i) { ... } // 错误：i 未初始化
```

**注意点**
*   ⚠️ **必须初始化**：控制结构中定义的变量必须显式初始化。
*   💡 这种设计确保了每次使用变量时都有确定的值。

---

## 🔑 本节总结
1.  **作用域限制**：在控制结构（if/switch/while/for）中定义的变量只在语句内部可见。
2.  **生命周期**：控制结构结束时，其中定义的变量立即被销毁。
3.  **外部访问**：如需在语句外部访问控制变量，必须在外部定义该变量。
4.  **初始化要求**：控制结构中定义的变量必须进行初始化，确保有确定的值。
5.  **设计优势**：这种作用域限制有助于避免命名冲突和提高代码封装性。

---

## 📌 考试速记版
*   **作用域规则**：控制结构中变量 = 语句内可见，语句外不可见
*   **访问控制**：需要外部访问 → 外部定义变量
*   **初始化**：控制结构变量必须初始化
*   **生命周期**：每次迭代重新创建和初始化
*   **口诀**："控制变量内定义，作用域内才可见；需要外访问，外部先定义；初始化不可少，安全又可靠"